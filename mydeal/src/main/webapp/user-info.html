<!doctype html>
<html lang="zxx">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>MyDeal</title>
    <link rel="icon" href="img/favicon.png">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <!-- animate CSS -->
    <link rel="stylesheet" href="css/animate.css">
    <!-- owl carousel CSS -->
    <link rel="stylesheet" href="css/owl.carousel.min.css">
    <!-- font awesome CSS -->
    <link rel="stylesheet" href="css/all.css">
    <!-- flaticon CSS -->
    <link rel="stylesheet" href="css/flaticon.css">
    <link rel="stylesheet" href="css/themify-icons.css">
    <!-- font awesome CSS -->
    <link rel="stylesheet" href="css/magnific-popup.css">
    <!-- swiper CSS -->
    <link rel="stylesheet" href="css/slick.css">
    <!-- style CSS -->
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
<!--::header part start::-->
<div id="headerContainer"></div>
<!-- Header part end-->

<!--================Register_part Area =================-->
<section class="login_part section_padding ">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6 col-md-6">
                <div class="login_part_form">
                    <div class="login_part_form_iner">
                        <h3>Your profile</h3>
                        <form class="row contact_form" action="register" method="post">
                            <!-- User Name Field -->
                            <div class="col-md-12 form-group p_star">
                                <input type="text" class="form-control" id="name" name="username" value=""
                                       placeholder="Username" required>
                            </div>
                            <!-- Email Field -->
                            <div class="col-md-12 form-group p_star">
                                <input type="email" class="form-control" id="email" name="email" value=""
                                       placeholder="Email" required>
                                <label id="emailValidity"></label>
                            </div>
                            <!-- Phone Number Field -->
                            <div class="col-md-12 form-group p_star">
                                <input type="tel" class="form-control" id="phoneNumber" name="phone_number" value=""
                                       placeholder="Phone Number" pattern="(010|011|012|015)[0-9]{8}" required>
                                <label id="phoneValidity"></label>
                            </div>
                            <!-- DOB Field -->
                            <div class="col-md-12 form-group p_star">
                                <input type="date" class="form-control" id="dob" name="date_of_birth" value=""
                                       placeholder="Date of Birth" required>
                            </div>
                            <!-- Credit Limit Field -->
                            <div class="col-md-12 form-group p_star">
                                <input type="number" class="form-control" id="creditLimit" name="credit_limit" value=""
                                       placeholder="Credit Limit" step="0.01" min="1" required>
                            </div>
                            <!-- Street Field -->
                            <div class="col-md-12 form-group p_star">
                                <input type="text" class="form-control" id="street" name="street" value=""
                                       placeholder="Street" required>
                            </div>
                            <!-- City Field -->
                            <div class="col-md-12 form-group p_star">
                                <input type="text" class="form-control" id="city" name="city" value=""
                                       placeholder="City" required>
                            </div>
                            <!-- Apartment Field -->
                            <div class="col-md-12 form-group p_star">
                                <input type="number" class="form-control" id="apartment" name="apartment" value=""
                                       placeholder="Apartment" min="1" max="100" required>
                            </div>
                            <!-- Password Field -->
                            <div class="col-md-12 form-group p_star">
                                <input type="password" class="form-control" id="password" name="password" value=""
                                       placeholder="Password" required>
                            </div>
                            <div class="col-md-12 form-group">
                                <button type="submit" value="submit" class="btn_3">
                                    Update Info
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!--================login_part end =================-->

<!-- jquery plugins here-->
<script src="js/jquery-1.12.1.min.js"></script>
<!-- popper js -->
<script src="js/popper.min.js"></script>
<!-- bootstrap js -->
<script src="js/bootstrap.min.js"></script>
<!-- easing js -->
<script src="js/jquery.magnific-popup.js"></script>
<!-- swiper js -->
<script src="js/swiper.min.js"></script>
<!-- swiper js -->
<script src="js/mixitup.min.js"></script>
<!-- particles js -->
<script src="js/owl.carousel.min.js"></script>
<script src="js/jquery.nice-select.min.js"></script>
<!-- slick js -->
<script src="js/slick.min.js"></script>
<script src="js/jquery.counterup.min.js"></script>
<script src="js/waypoints.min.js"></script>
<script src="js/contact.js"></script>
<script src="js/jquery.ajaxchimp.min.js"></script>
<script src="js/jquery.form.js"></script>
<script src="js/jquery.validate.min.js"></script>
<script src="js/mail-script.js"></script>
<!-- custom js -->
<script src="js/custom.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        var dob = document.getElementById("dob");

        function validateDOB() {
            var enteredDOB = new Date(dob.value);
            var today = new Date();
            if (enteredDOB >= today) {
                dob.setCustomValidity("Date of birth must be in the past");
            } else {
                dob.setCustomValidity('');
            }
        }

        dob.onchange = validateDOB;
    });
    document.addEventListener('DOMContentLoaded', function () {
        var password = document.getElementById("password");
        var confirmPassword = document.getElementById("confirmPassword");

        function validatePassword() {
            if (password.value != confirmPassword.value) {
                confirmPassword.setCustomValidity("Passwords don't match");
            } else {
                confirmPassword.setCustomValidity('');
            }
        }

        password.onchange = validatePassword;
        confirmPassword.onkeyup = validatePassword;
    });
</script>
<script>
    function checkFormValidity() {
        if ($('#emailValidity').is(':visible') || $('#phoneValidity').is(':visible')) {
            $('button[type="submit"]').prop('disabled', true);
        } else {
            $('button[type="submit"]').prop('disabled', false);
        }
    }
</script>
<script>
    function loadDataFromLocalStorage() {
        // Retrieve values from localStorage
        var username = localStorage.getItem('username');
        var email = localStorage.getItem('email');
        var phoneNumber = localStorage.getItem('phoneNumber');
        var dob = localStorage.getItem('dob'); // This will be a string, you might need to convert it back to a Date object
        var creditLimit = localStorage.getItem('creditLimit'); // This will be a string, you might need to convert it back to a float
        var street = localStorage.getItem('street');
        var city = localStorage.getItem('city');
        var apartment = localStorage.getItem('apartment'); // This will be a string, you might need to convert it back to an integer
        var password = localStorage.getItem('password');
        // Assign values to HTML elements
        document.getElementById("name").value = username;
        document.getElementById("email").value = email;
        document.getElementById("phoneNumber").value = phoneNumber;
        // Assuming dob is stored as a string in localStorage
        var dobString = localStorage.getItem('dob');
// Parse the string into a Date object
        var dobDate = new Date(dobString);
// Format the Date object as a string in the format YYYY-MM-DD
        var formattedDob = dobDate.toISOString().substr(0, 10);
// Assign the formatted string to the HTML element
        document.getElementById("dob").value = formattedDob;
        document.getElementById("creditLimit").value = Number.parseFloat(creditLimit); // Assuming creditLimit is stored as a string
        document.getElementById("street").value = street;
        document.getElementById("city").value = city;
        document.getElementById("apartment").value = Number.parseInt(apartment); // Assuming apartment is stored as a string
        document.getElementById("password").value = password;
        console.log("Load Data From Local Storage Called");
        console.log(`email: ${email} , password : ${password} , phone number : ${phoneNumber} , dob : ${dob} , credit limit : ${creditLimit} , street : ${street} , city : ${city} , apartment : ${apartment}`);
    }

    $(document).ready(function () {
        $('#emailValidity').hide();
        $('#phoneValidity').hide();
        $('#phoneNumber').on('blur', function () {
            var phoneNumber = $(this).val();
            if (phoneNumber.length == 0) {
                $('#phoneValidity').hide();
                $('#phoneValidity').text(`You can't leave this Field Empty !!`).css("color", "red");
            } else if (phoneNumber.length == 11) {
                $('#phoneValidity').hide();
                // this means that we need to check on
                $.ajax({
                    url: 'validate', // Change this to the URL where you handle validation
                    type: 'POST',
                    data: {phone_number: phoneNumber},
                    success: function (response) {
                        if (response.trim() == 'valid') {
                            $('#phoneValidity').hide();
                            $('#phoneValidity').text('Phone Number is Valid ✅').css('color', 'green');
                        } else {
                            $('#phoneValidity').text('   This phone number is already exist').css('color', 'red');
                        }
                    },
                    beforeSend: function () {
                        $('#phoneValidity').show();
                        $('#phoneValidity').text('Validating ...').css('color', 'grey');
                    }
                });
            } else {
                $('#phoneValidity').show();
                $('#phoneValidity').text('phone number must be 11 Digit').css('color', 'red');
            }
        });
        $('#email').on('blur', function () {
            var email = $(this).val();
            // check email  regex if it is valid :
            var re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (email.length == 0) {
                $('#emailValidity').hide();
                $('#emailValidity').text("You Can't leave this field empty !!");
            } else if (email.length != 0 && re.test(email)) {
                $('#emailValidity').hide();
                $.ajax({
                    url: 'validate', // Change this to the URL where you handle validation
                    type: 'POST',
                    data: {email: email},
                    beforeSend: function () {
                        $('#emailValidity').show();
                        $('#emailValidity').text('Validating ...').css('color', 'grey');
                    },
                    success: function (response) {
                        if (response.trim() == 'valid') {
                            $('#emailValidity').hide();
                            $('#emailValidity').text('Email is Valid ✅').css('color', 'green');
                        } else {
                            $('#emailValidity').show();
                            $('#emailValidity').text('   This email is already exist').css('color', 'red');
                        }
                    }, onerror: function () {
                        $('#emailValidity').text('There is an error occurred').css('color', 'red');
                    }
                });
            } else {
                $('#emailValidity').show();
                $('#emailValidity').text("This email is invalid");
            }
        });
        $('form').on('submit', function (event) {
            if ($('#emailValidity').is(':visible') || $('#phoneValidity').is(':visible')) {
                event.preventDefault();
            }
            var isValid = true;

            // Remove existing error messages
            $('.error-message').remove();

            // Validate each input field
            $(this).find('input[required]').each(function () {
                if (!$(this).val()) {
                    isValid = false;
                    $(this).addClass('error');
                    $(this).after('<span class="error-message">You can\'t leave this field empty !!</span>');
                } else {
                    $(this).removeClass('error');
                }
            });
            // Prevent form submission if validation fails
            if (!isValid) {
                event.preventDefault();
            }
        });
        $('input[required]').on('input', function () {
            $(this).removeClass('error');
            $(this).next('.error-message').remove();
        });
        // $.ajax({
        //     type: 'GET',
        //     url: 'updateUserInfo',
        //     data: {email: localStorage.getItem("email"), password: localStorage.getItem("password")}, // Send data as form parameters
        //     success: function (data) {
        //         alert("Customer Data Fetched from Server successfully!");
        //     },
        //     error: function (xhr, status, error) {
        //         // Handle error
        //         console.error('Error logging in:', error);
        //         // You can show an error message to the user or take any other appropriate action
        //     }
        // });
        checkFormValidity();
        loadDataFromLocalStorage();
    });
</script>
<script>
    $(document).ready(function () {
        // Fetch and include the header HTML
        $("#headerContainer").load("myDealHeader.html");
    });
</script>
</body>

</html>